<!DOCTYPE html>
<html>

<head>
    <title>Sasha's Aquarium</title>

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://fishtank1.netlify.app/">
    <meta property="og:title" content="Sasha's Virtual Aquarium">
    <meta property="og:description" content="A special 3D aquarium built just for you.">
    <meta property="og:image" content="https://fishtank1.netlify.app/assets/bg.jpg">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            margin: 0;
            overflow: hidden;
            background-color: #001e36;

            /* 1. The Original Image */
            background-image: url('assets/bg.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        /* --- ðŸŒŠ THE TINT LAYER --- */
        #tint-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            background: rgba(0, 30, 54, 0.4);
            pointer-events: none;
        }

        canvas {
            display: block;
            position: relative;
            z-index: 1;
        }

        #partyBtn {
            position: absolute;
            bottom: 30px;
            right: 30px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid white;
            color: #333;
            padding: 10px 20px;
            border-radius: 30px;
            font-family: sans-serif;
            font-weight: bold;
            cursor: pointer;
            backdrop-filter: blur(5px);
            font-size: 16px;
            transition: all 0.3s ease;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* FISH DIRECTORY UI */
        #directoryBtn {
            position: absolute;
            top: 20px;
            left: 20px;
            /* Left side to balance Party Mode */
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 30px;
            color: white;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        #directoryBtn:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: scale(1.05);
        }

        #directoryModal {
            display: none;
            /* Hidden by default */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: rgba(20, 20, 30, 0.9);
            width: 800px;
            max-width: 90%;
            height: 500px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            overflow: hidden;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            font-family: 'Inter', sans-serif;
            color: white;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            color: rgba(255, 255, 255, 0.5);
            z-index: 10;
        }

        .close-btn:hover {
            color: white;
        }

        /* Directory List (Left) */
        .fish-list {
            width: 35%;
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            overflow-y: auto;
        }

        .fish-item {
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .fish-item:hover,
        .fish-item.active {
            background: rgba(64, 224, 208, 0.2);
            /* Turquoise tint */
            border: 1px solid rgba(64, 224, 208, 0.4);
        }

        .fish-icon {
            font-size: 20px;
        }

        /* Bio Card (Right) */
        .fish-bio-panel {
            width: 65%;
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            background: linear-gradient(135deg, rgba(20, 20, 30, 0) 0%, rgba(0, 0, 0, 0.4) 100%);
        }

        .bio-image-placeholder {
            width: 180px;
            height: 180px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            margin-bottom: 20px;
            object-fit: cover;
            /* Ensure image covers the circle */
            border: 4px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 30px rgba(64, 224, 208, 0.3);
        }

        .bio-name {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
            color: #40e0d0;
        }

        .bio-species {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
        }

        .bio-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            background: rgba(0, 0, 0, 0.2);
            padding: 15px 30px;
            border-radius: 12px;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .stat-label {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.5);
        }

        .stat-value {
            font-size: 16px;
            font-weight: 600;
        }

        .bio-text {
            font-size: 16px;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
            max-width: 80%;
        }

        @media (max-width: 768px) {
            .modal-content {
                flex-direction: column;
                height: 90%;
            }

            .fish-list {
                width: 100%;
                height: 30%;
                border-right: none;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                display: flex;
                overflow-x: auto;
                padding: 10px;
                gap: 10px;
            }

            .fish-item {
                width: 140px;
                flex-shrink: 0;
                flex-direction: column;
                justify-content: center;
                text-align: center;
            }

            .fish-bio-panel {
                width: 100%;
                height: 70%;
                padding: 20px;
                overflow-y: auto;
            }
        }
    </style>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>

<body>
    <div id="tint-layer"></div>

    <button id="directoryBtn">ðŸ“– Fish Guide</button>
    <button id="partyBtn">ðŸª© Party Mode</button>

    <!-- Fish Directory Modal -->
    <div id="directoryModal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>

            <div class="fish-list" id="fishList">
                <!-- Populated by JS -->
            </div>

            <div class="fish-bio-panel">
                <img class="bio-image-placeholder" id="bioImage" src="assets/sasha-bio.png" alt="Fish Portrait">
                <div class="bio-name" id="bioName">Select a Fish</div>
                <div class="bio-species" id="bioSpecies">Welcome to the Tank</div>

                <div class="bio-stats" id="bioStats" style="display:none;">
                    <!-- Stats go here -->
                </div>

                <div class="bio-text" id="bioText">
                    Click on a name from the list on the left to learn more about our aquatic friends!
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // 1. Setup Scene
        const scene = new THREE.Scene();
        const chillFog = new THREE.Fog(0x001e36, 5, 20); // Fog adjusted closer for new view
        scene.fog = chillFog;

        // 2. Camera (UPDATED for Zoomed-In Look)
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        // Changed from (0, 2, 9) to (0, 1, 6) -> Closer and more eye-level
        camera.position.set(0, 1, 6);

        // 3. Renderer
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.outputColorSpace = THREE.SRGBColorSpace;
        document.body.appendChild(renderer.domElement);

        // --- STANDARD LIGHTING ---
        const ambientLight = new THREE.AmbientLight(0xffffff, 1.5);
        scene.add(ambientLight);
        const topLight = new THREE.DirectionalLight(0xffffff, 3);
        topLight.position.set(5, 10, 7);
        scene.add(topLight);
        const frontLight = new THREE.DirectionalLight(0xffffff, 1);
        frontLight.position.set(0, 0, 10);
        scene.add(frontLight);

        // --- RAVE RIG ---
        const raveGroup = new THREE.Group();
        scene.add(raveGroup);
        raveGroup.visible = false;

        // A. DISCO BALL
        const discoBallGeo = new THREE.SphereGeometry(1.5, 32, 32);
        const discoBallMat = new THREE.MeshPhysicalMaterial({
            color: 0xffffff,
            roughness: 0.0,
            metalness: 1.0,
            reflectivity: 1.0,
            clearcoat: 1.0,
            emissive: 0x111111,
            envMapIntensity: 5.0
        });
        const discoBall = new THREE.Mesh(discoBallGeo, discoBallMat);
        discoBall.position.set(0, 8, 0);
        raveGroup.add(discoBall);

        // B. FILL & SPOT LIGHTS
        const raveHemi = new THREE.HemisphereLight(0xff00ff, 0x00ffff, 0.8);
        raveGroup.add(raveHemi);

        function createSpotLight(color, xPos, zPos) {
            const spot = new THREE.SpotLight(color, 2000);
            spot.angle = 0.8;
            spot.penumbra = 0.5;
            spot.position.set(xPos, 5, zPos);
            spot.target = discoBall;
            raveGroup.add(spot);
            return spot;
        }
        createSpotLight(0xff00ff, -10, 10);
        createSpotLight(0x00ffff, 10, 10);
        createSpotLight(0xffff00, 0, -10);

        // --- MATERIALS ---
        const raveMaterial = new THREE.MeshPhysicalMaterial({
            color: 0xffffff,
            metalness: 1.0,
            roughness: 0.05,
            ior: 2.5,
            reflectivity: 1.0,
            clearcoat: 1.0,
            emissive: 0x222244,
            emissiveIntensity: 0.2
        });
        raveMaterial.envMapIntensity = 3.0;

        const pmremGenerator = new THREE.PMREMGenerator(renderer);
        pmremGenerator.compileEquirectangularShader();

        new THREE.TextureLoader().load('assets/bg.jpg', function (texture) {
            texture.mapping = THREE.EquirectangularReflectionMapping;
            texture.colorSpace = THREE.SRGBColorSpace;
            raveMaterial.envMap = texture;
            discoBallMat.envMap = texture;
            scene.environment = texture;
            raveMaterial.needsUpdate = true;
            discoBallMat.needsUpdate = true;
        });

        // --- 5. PARTICLES ---
        const particlesGeometry = new THREE.BufferGeometry();
        const particlesCount = 1000;
        const posArray = new Float32Array(particlesCount * 3);
        for (let i = 0; i < particlesCount * 3; i++) {
            posArray[i] = (Math.random() - 0.5) * 30;
        }
        particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        const particlesMaterial = new THREE.PointsMaterial({
            size: 0.05, color: 0xffffff, transparent: true, opacity: 0.6
        });
        const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
        scene.add(particlesMesh);

        // --- 6. FISH SYSTEM ---
        const loader = new GLTFLoader();
        const fishSchool = [];
        const raveSquad = [];

        function addFish(fileName, scale, speed, timeOffset, yOffset, isRaveOnly = false) {
            loader.load(`assets/${fileName}`, function (gltf) {
                const fish = gltf.scene;
                fish.scale.set(scale, scale, scale);

                // Check if this is Sasha
                const isSasha = fileName.includes('sasha');

                if (gltf.animations && gltf.animations.length > 0) {
                    const mixer = new THREE.AnimationMixer(fish);
                    const action = mixer.clipAction(gltf.animations[0]);
                    action.play();
                    fish.userData.mixer = mixer;
                }

                const box = new THREE.Box3().setFromObject(fish);
                const center = box.getCenter(new THREE.Vector3());
                fish.position.sub(center);

                if (isRaveOnly) {
                    fish.visible = false;
                    raveSquad.push(fish);
                } else {
                    fishSchool.push(fish);
                }
                scene.add(fish);

                // --- SPECIAL MATERIAL FIXES ---
                if (fileName === 'linguiniii.glb') {
                    // Fix for "Black Back" issue: Apply red emissive to fill in dark areas
                    fish.traverse((child) => {
                        if (child.isMesh) {
                            // Use a soft fabric-like roughness
                            child.material.roughness = 1.0;
                            child.material.metalness = 0.0;
                            // Add red glow to cover black pixels
                            child.material.emissive = new THREE.Color(0xaa2222);
                            child.material.emissiveIntensity = 0.4;
                            // Ensure double sided to prevent backface culling holes
                            child.material.side = THREE.DoubleSide;
                        }
                    });
                }

                // Store Data
                fish.userData.speed = speed;
                fish.userData.offset = timeOffset;
                fish.userData.yBase = yOffset;
                fish.userData.isRaveOnly = isRaveOnly;
                fish.userData.isSasha = isSasha;
                fish.userData.originalMaterial = null;

            }, undefined, function (error) {
                console.error(`Could not load ${fileName}:`, error);
            });
        }

        // ============================================
        // ðŸ  FISH ROLL CALL
        // ============================================

        // SASHA: Hero
        addFish('sasha-scuba.glb', 1.5, 0.1, 0, 0);

        // ADD LINGUINIII HERE:
        addFish('linguiniii.glb', 1.0, 0.3, 3, 1.5);

        addFish('shark.glb', 1.8, 0.45, 2, 2.0);
        addFish('manta.glb', 2.5, 0.1, 3, -3.5);

        // Reduced fish count
        addFish('tetra.glb', 1.0, 0.55, 0, 0.0);
        addFish('tetra.glb', 0.9, 0.6, 0.5, 0.5);
        addFish('tetra.glb', 1.1, 0.5, 1.0, -0.5);
        addFish('tetra.glb', 0.8, 0.65, 2.0, 0.2);

        addFish('squirrelfish.glb', 1.5, 0.25, 0, -2.0);
        addFish('squirrelfish.glb', 1.4, 0.3, 2, -1.5);

        addFish('angelfish.glb', 1.3, 0.15, 1, -0.5);
        addFish('angelfish.glb', 1.2, 0.16, 2.5, -0.8);
        // ðŸ§¡ RONAN (Seahorse) - THE LATE ARRIVAL
        // Scale: 4.5 | Delay: 3 Seconds
        setTimeout(() => {
            addFish('ronanseahorse.glb', 4.5, 0.2, 5.5, -1.2);
        }, 3000);

        // RAVE SQUAD
        for (let i = 0; i < 4; i++) {
            addFish('shark.glb', 1.5 + Math.random() * 0.5, 0.4 + Math.random() * 0.2, Math.random() * 10, (Math.random() - 0.5) * 5, true);
        }
        for (let i = 0; i < 5; i++) {
            addFish('squirrelfish.glb', 1.2 + Math.random() * 0.4, 0.2 + Math.random() * 0.1, Math.random() * 10, (Math.random() - 0.5) * 5, true);
        }

        // ============================================
        // ðŸ“– FISH DIRECTORY DATA & LOGIC
        // ============================================
        const fishBios = {
            "Sasha Scuba": {
                species: "Homo Sapiens Aquaticus",
                icon: "ðŸ¤¿",
                image: "assets/sasha-bio-v2.png",
                stats: { "Dives Logged": "400+", "Cert Level": "Divemaster", "Role": "Hero" },
                bio: "Sasha is a PADI certified divemaster with over 400 dives logged. She keeps the peace in the tank and ensures all the fish stay in formation. She's the only one who knows how to operate the filter."
            },
            "Linguiniii": {
                species: "Canadian Maple Fish",
                icon: "ðŸ",
                image: "assets/linguiniii-bio.png",
                stats: { "Material": "Soft Fabric", "Origin": "Canada", "Cuteness": "100%" },
                bio: "Linguiniii is a rare Canadian Maple Fish, made entirely of soft fabric. Despite being a bean bag, he's an excellent swimmer. He is red all the way around and incredibly polite."
            },
            "Ronan": {
                species: "Hippocampus Executive",
                icon: "ðŸ‘”",
                image: "assets/ronan-bio-v2.png",
                stats: { "Attire": "Business Casual", "Vision": "Corrected", "Stress": "Low" },
                bio: "Ronan is a seahorse who means business. Dressed in a navy cardigan and khakis, he brings a level of professionalism to the reef that is frankly unnecessary. He enjoys reading financial reports on waterproof paper."
            },
            "Shark": {
                species: "Selachimorpha",
                icon: "ðŸ¦ˆ",
                image: "assets/shark-bio.png",
                stats: { "Speed": "Fast", "Teeth": "Many", "Vibe": "Misunderstood" },
                bio: "The tank's resident muscle. He looks tough, but mostly he just circles around looking for snacks. He's actually quite friendly if you don't make sudden movements."
            },
            "Manta": {
                species: "Mobula alfredi",
                icon: "ðŸª",
                image: "assets/manta-bio.png",
                stats: { "Wingspan": "Impressive", "Gliding": "10/10", "Grace": "High" },
                bio: "The Manta Ray is the glider of the group. She prefers the wide open spaces of the upper tank and dreams of the open ocean."
            },
            "Tetra": {
                species: "Paracheirodon",
                icon: "ðŸŸ",
                image: "assets/tetra-bio.png",
                stats: { "Count": "Many", "Size": "Small", "Schooling": "Yes" },
                bio: "The Tetras are the background dancers of the aquarium. They move as one and add a splash of neon color to the scene."
            },
            "Squirrelfish": {
                species: "Holocentridae",
                icon: "ðŸ ",
                image: "assets/squirrelfish-bio.png",
                stats: { "Eyes": "Huge", "Color": "Red", "Night Vision": "Yes" },
                bio: "With their giant eyes, the Squirrelfish see everything. They are excellent at finding food in low light and judging the other fish silently."
            },
            "Angelfish": {
                species: "Pterophyllum",
                icon: "ðŸ‘¼",
                image: "assets/angelfish-bio.png",
                stats: { "Shape": "Triangle", "Elegance": "Maximum", "Attitude": "Royalty" },
                bio: "The Angelfish believe they own the tank. They swim with a regal slow-motion energy that suggests they are better than everyone else."
            }
        };

        const dirBtn = document.getElementById('directoryBtn');
        const dirModal = document.getElementById('directoryModal');
        const closeBtn = document.querySelector('.close-btn');
        const fishList = document.getElementById('fishList');

        // Populate List
        Object.keys(fishBios).forEach(name => {
            const item = document.createElement('div');
            item.className = 'fish-item';
            item.innerHTML = `<span class="fish-icon">${fishBios[name].icon}</span> ${name}`;
            item.onclick = function () {
                showBio(name);
                document.querySelectorAll('.fish-item').forEach(el => el.classList.remove('active'));
                this.classList.add('active');
            };
            fishList.appendChild(item);
        });

        function showBio(name) {
            const data = fishBios[name];
            document.getElementById('bioImage').src = data.image; // Update Image Source
            document.getElementById('bioName').innerText = name;
            document.getElementById('bioSpecies').innerText = data.species;
            document.getElementById('bioText').innerText = data.bio;

            const statsContainer = document.getElementById('bioStats');
            statsContainer.style.display = 'flex';
            statsContainer.innerHTML = '';

            for (const [key, value] of Object.entries(data.stats)) {
                const div = document.createElement('div');
                div.className = 'stat-item';
                div.innerHTML = `<span class="stat-label">${key}</span><span class="stat-value">${value}</span>`;
                statsContainer.appendChild(div);
            }
        }

        // Open/Close Logic
        dirBtn.onclick = () => {
            dirModal.style.display = 'flex';
            if (document.getElementById('bioName').innerText === 'Select a Fish') showBio('Sasha Scuba');
        };
        closeBtn.onclick = () => dirModal.style.display = 'none';
        window.onclick = (e) => {
            if (e.target == dirModal) dirModal.style.display = 'none';
        };

        // ============================================
        // ðŸŽ›ï¸ MODE SWITCHING
        // ============================================
        let isPartyMode = false;
        const btn = document.getElementById('partyBtn');

        btn.addEventListener('click', () => {
            isPartyMode = !isPartyMode;

            if (isPartyMode) {
                btn.innerText = "ðŸ›‘ Chill Mode";
                btn.style.background = "rgba(255, 0, 100, 1.0)";
                btn.style.color = "white";
                scene.fog = new THREE.Fog(0x220033, 10, 40);
                raveGroup.visible = true;

                const allFish = [...fishSchool, ...raveSquad];
                allFish.forEach(fish => {
                    if (fish.userData.isRaveOnly) fish.visible = true;
                    fish.traverse((child) => {
                        if (child.isMesh) {
                            if (!child.userData.originalMaterial) child.userData.originalMaterial = child.material;
                            const myRaveMat = raveMaterial.clone();
                            const hue = Math.random();
                            myRaveMat.color.setHSL(hue, 0.8, 0.5);
                            myRaveMat.emissive.setHSL(hue, 1.0, 0.1);
                            child.material = myRaveMat;
                        }
                    });
                });

            } else {
                btn.innerText = "ðŸª© Party Mode";
                btn.style.background = "rgba(255, 255, 255, 0.9)";
                btn.style.color = "#333";
                document.body.style.filter = "none";
                scene.fog = chillFog;
                ambientLight.intensity = 1.5;
                topLight.intensity = 3;
                frontLight.intensity = 1;
                raveGroup.visible = false;

                const allFish = [...fishSchool, ...raveSquad];
                allFish.forEach(fish => {
                    if (fish.userData.isRaveOnly) fish.visible = false;
                    fish.traverse((child) => {
                        if (child.isMesh && child.userData.originalMaterial) {
                            child.material = child.userData.originalMaterial;
                        }
                    });
                });
            }
        });

        // 7. Animation Loop
        const clock = new THREE.Clock();

        function animate() {
            requestAnimationFrame(animate);

            const delta = clock.getDelta();
            const masterTime = clock.getElapsedTime();

            if (isPartyMode) {
                discoBall.rotation.y += 0.05;
                discoBall.rotation.z = Math.sin(masterTime) * 0.2;
                particlesMaterial.opacity = 0.5 + Math.sin(masterTime * 20) * 0.3;
                particlesMaterial.size = 0.08 + Math.sin(masterTime * 10) * 0.03;
            }

            particlesMesh.rotation.y = masterTime * 0.05;
            particlesMesh.position.y = Math.sin(masterTime * 0.2) * 0.5;

            const allFish = [...fishSchool, ...raveSquad];
            allFish.forEach(fish => {
                if (!fish.visible) return;

                if (fish.userData.mixer) {
                    fish.userData.mixer.update(delta);
                }

                const data = fish.userData;

                // --- ðŸŒŸ SASHA'S HERO LOGIC ðŸŒŸ ---
                if (data.isSasha) {
                    const driftX = Math.sin(masterTime * 0.5) * 2.0;
                    const driftY = Math.sin(masterTime * 0.8) * 0.5;
                    fish.position.set(driftX, driftY, 0);
                    fish.rotation.y = Math.sin(masterTime * 0.3) * 0.5;

                } else {
                    const time = (masterTime * data.speed) + data.offset;
                    const nextT = time + 0.1;

                    const x = Math.sin(time) * 7.0;
                    const z = Math.sin(time * 2) * 4.5;
                    const y = Math.sin(time * 1.5) * 1.0 + data.yBase;

                    const nextX = Math.sin(nextT) * 7.0;
                    const nextZ = Math.sin(nextT * 2) * 4.5;
                    const nextY = Math.sin(nextT * 1.5) * 1.0 + data.yBase;

                    fish.position.set(x, y, z);
                    fish.lookAt(nextX, nextY, nextZ);
                }
            });

            controls.update();
            renderer.render(scene, camera);
        }

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.minDistance = 2; // Allow user to zoom in even more if they want
        controls.maxDistance = 15;
        controls.maxPolarAngle = Math.PI / 2 - 0.1;
        controls.enablePan = false;

        function adjustCameraForMobile() {
            const aspect = window.innerWidth / window.innerHeight;
            camera.aspect = aspect;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);

            // UPDATED: Logic to keep the zoomed-in feel on mobile too
            if (aspect < 1) {
                camera.position.z = 10; // Closer mobile default
            } else {
                camera.position.z = 6;  // Closer desktop default
            }
        }
        adjustCameraForMobile();
        window.addEventListener('resize', adjustCameraForMobile);

        animate();
    </script>
</body>

</html>